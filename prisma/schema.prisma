generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")  
}

model User {
  id           Int      @id @default(autoincrement())
  name         String
  email        String   @unique
  password     String   // Será preenchida temporariamente no cadastro, e atualizada pelo Admin
  userType      String    @default("comum")
  status       String   @default("PENDING") // PENDING, APPROVED, REJECTED
  active       Boolean  @default(false)
  
  // Role: "USER" (Comum), "ADMIN", "PROFESSIONAL"
  role         String   @default("USER") 
  
  color        String?  @default("#0d9488")
  serviceStart String?
  serviceEnd   String?
  
  permissions  Json?
  notifications Json?
  commissions  Json?
  
  createdAt    DateTime @default(now())
}

// prisma/schema.prisma

model Appointment {
  id           Int      @id @default(autoincrement())
  title        String   // Nome do cliente
  phone        String?
  date         DateTime
  startTime    String
  endTime      String
  
  // --- NOVOS CAMPOS ADICIONADOS ---
  procedure    String?  // Procedimento (Consulta, Avaliação...)
  professional String?  // Profissional (Joao, Jessica...)
  location     String?  // Sala Principal, Sala 02...
  notify       String?  @default("nao_notificar") // email, sms...
  repeat       Boolean  @default(false)
  notes        String?  // Motivo da consulta
  color        String?  @default("blue") // Cor do agendamento
  type         String   @default("consultation")

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relação com Paciente (Opcional, se você já tiver)
  patientId    Int?
  patient      Patient? @relation(fields: [patientId], references: [id])
}

// Atualize o model Patient existente
model Patient {
  id            Int       @id @default(autoincrement())
  name          String
  cpf           String?   @unique
  rg            String?   // Novo
  birthDate     DateTime? // Novo
  age           String?   // Novo
  instagram     String?   // Novo
  profession    String?   // Novo
  workplace     String?   // Novo
  gender        String?   // Novo
  civilStatus   String?   // Novo
  referral      String?   // Indicação
  notes         String?   // Observações

  // Dados de Emergência / Saúde
  emergencyName  String?
  emergencyPhone String?
  healthPlan     String?
  bloodType      String?

  // Relacionamentos
  contacts     Contact[]
  addresses    Address[]
  responsibles Responsible[]
  appointments Appointment[] // Relacionamento com agendamentos

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Adicione estes models no final do arquivo (se não tiver)
model Contact {
  id        Int     @id @default(autoincrement())
  type      String  // "phone" ou "email"
  value     String
  patientId Int
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model Address {
  id        Int     @id @default(autoincrement())
  street    String
  patientId Int
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model Responsible {
  id        Int     @id @default(autoincrement())
  name      String
  patientId Int
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model Service {
  id        Int      @id @default(autoincrement())
  name      String
  active    Boolean  @default(true)
}

model Location {
  id        Int      @id @default(autoincrement())
  name      String
  active    Boolean  @default(true)
}

model Professional {
  id        Int     @id @default(autoincrement())
  name      String
  specialty String? // Especialidade (Ex: Cardiologista)
  register  String? // CRM, CRO, etc.
  phone     String?
  email     String?
  color     String  @default("blue") // Cor para o calendário
  active    Boolean @default(true)
}