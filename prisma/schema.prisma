generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")  
}

model User {
  id           Int      @id @default(autoincrement())
  name         String
  email        String   @unique
  password     String   // Será preenchida temporariamente no cadastro, e atualizada pelo Admin
  userType      String    @default("comum")
  status       String   @default("PENDING") // PENDING, APPROVED, REJECTED
  active       Boolean  @default(false)
  
  // Role: "USER" (Comum), "ADMIN", "PROFESSIONAL"
  role         String   @default("USER") 
  
  color        String?  @default("#0d9488")
  serviceStart String?
  serviceEnd   String?
  
  permissions  Json?
  notifications Json?
  commissions  Json?
  
  createdAt    DateTime @default(now())
}

// prisma/schema.prisma

model Appointment {
  id           Int      @id @default(autoincrement())
  title        String   // Nome do cliente (para exibição rápida)
  date         DateTime
  startTime    String?
  endTime      String?
  procedure    String?
  professional String?
  location     String?
  phone        String?
  notify       String?
  notes        String?
  type         String?  // Ex: "consultation"
  
  // --- AQUI ESTÁ A CORREÇÃO (O RELACIONAMENTO) ---
  patientId    Int?     // Campo que guarda o ID do paciente (Opcional para permitir agendar sem cadastro)
  patient      Patient? @relation(fields: [patientId], references: [id]) 

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Patient {
  id            Int      @id @default(autoincrement())
  name          String
  cpf           String?  @unique
  rg            String?
  birthDate     DateTime? // Novo
  age           String?   // Novo (pode ser calculado, mas vamos salvar por enquanto)
  instagram     String?   // Novo
  profession    String?   // Novo
  workplace     String?   // Novo
  gender        String?   // Novo
  civilStatus   String?   // Novo
  referral      String?   // Indicação
  notes         String?   // Observações
  
  // Dados de Emergência
  emergencyName  String?
  emergencyPhone String?
  healthPlan     String?
  bloodType      String?

  // Relacionamentos (json ou tabelas separadas, mantendo simples aqui)
  contacts      Contact[]
  addresses     Address[]
  responsibles  Responsible[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  appointments  Appointment[]
}

// --- TABELAS RELACIONADAS AO PACIENTE ---

model Contact {
  id        Int     @id @default(autoincrement())
  type      String  // Ex: "phone" ou "email"
  value     String  // Ex: "(11) 99999-9999"
  patientId Int
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model Address {
  id        Int     @id @default(autoincrement())
  street    String  // Endereço completo
  patientId Int
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model Responsible {
  id        Int     @id @default(autoincrement())
  name      String  // Nome do responsável
  patientId Int
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
}